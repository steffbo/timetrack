openapi: 3.0.3
info:
  title: Time Tracking API
  description: API for time tracking application with user management, working hours configuration, and time entry tracking
  version: 0.1.0
  contact:
    name: Stefan Remer
    email: stefan.remer@example.com

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Users
    description: User management operations
  - name: Working Hours
    description: Working hours configuration per weekday
  - name: Recurring Off-Days
    description: Recurring off-day patterns (e.g., every 4th Monday)
  - name: Recurring Off-Day Warnings
    description: Warnings when work entries occur on recurring off-days
  - name: Time Off
    description: Time-off tracking (vacation, sick, personal days, holidays)
  - name: Vacation Balance
    description: Vacation balance management
  - name: Public Holidays
    description: German public holidays calculator
  - name: Time Entries
    description: Time tracking operations (clock in/out)
  - name: Statistics
    description: Reports and statistics

security:
  - bearerAuth: []

paths:
  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and receive JWT tokens
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Successful authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using refresh token
      operationId: refreshToken
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Invalidate refresh token
      operationId: logout
      responses:
        '204':
          description: Successfully logged out
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/users:
    get:
      tags:
        - Users
      summary: List all users
      description: Get list of all users (Admin only)
      operationId: getAllUsers
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - Users
      summary: Create new user
      description: Create a new user (Admin only)
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/users/me:
    get:
      tags:
        - Users
      summary: Get current user profile
      description: Get the profile of the authenticated user
      operationId: getCurrentUser
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      description: Get user details by ID (Admins can get any user, users can only get themselves)
      operationId: getUserById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Users
      summary: Update user
      description: Update user details (Admins can update any user, users can only update themselves)
      operationId: updateUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Users
      summary: Delete user
      description: Delete user (Admin only)
      operationId: deleteUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: User deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/working-hours:
    get:
      tags:
        - Working Hours
      summary: Get working hours configuration
      description: Get the working hours configuration for the authenticated user
      operationId: getWorkingHours
      responses:
        '200':
          description: Working hours retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkingHoursResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Working Hours
      summary: Update working hours configuration
      description: Update the working hours configuration for the authenticated user
      operationId: updateWorkingHours
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkingHoursRequest'
      responses:
        '200':
          description: Working hours updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkingHoursResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/working-hours/{userId}:
    get:
      tags:
        - Working Hours
      summary: Get working hours for specific user
      description: Get the working hours configuration for a specific user (Admin only)
      operationId: getWorkingHoursByUserId
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Working hours retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkingHoursResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/recurring-off-days:
    get:
      tags:
        - Recurring Off-Days
      summary: Get all recurring off-days
      description: Get all recurring off-day rules for the authenticated user
      operationId: getRecurringOffDays
      responses:
        '200':
          description: Recurring off-days retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RecurringOffDayResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Recurring Off-Days
      summary: Create recurring off-day rule
      description: Create a new recurring off-day rule
      operationId: createRecurringOffDay
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRecurringOffDayRequest'
      responses:
        '201':
          description: Recurring off-day created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecurringOffDayResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recurring-off-days/{id}:
    put:
      tags:
        - Recurring Off-Days
      summary: Update recurring off-day rule
      description: Update an existing recurring off-day rule
      operationId: updateRecurringOffDay
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRecurringOffDayRequest'
      responses:
        '200':
          description: Recurring off-day updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecurringOffDayResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Recurring Off-Days
      summary: Delete recurring off-day rule
      description: Delete a recurring off-day rule
      operationId: deleteRecurringOffDay
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Recurring off-day deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/recurring-off-day-warnings:
    get:
      tags:
        - Recurring Off-Day Warnings
      summary: Get conflict warnings
      description: Get all recurring off-day conflict warnings for the authenticated user
      operationId: getConflictWarnings
      parameters:
        - name: unacknowledgedOnly
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Return only unacknowledged warnings
      responses:
        '200':
          description: Warnings retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RecurringOffDayConflictWarningResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recurring-off-day-warnings/{id}/acknowledge:
    post:
      tags:
        - Recurring Off-Day Warnings
      summary: Acknowledge a warning
      description: Mark a warning as acknowledged (warning persists for calendar highlighting)
      operationId: acknowledgeWarning
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Warning acknowledged successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecurringOffDayConflictWarningResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/time-off:
    get:
      tags:
        - Time Off
      summary: Get all time-off entries
      description: Get all time-off entries for the authenticated user
      operationId: getTimeOffEntries
      parameters:
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Filter entries starting from this date
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Filter entries up to this date
      responses:
        '200':
          description: Time-off entries retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TimeOffResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Time Off
      summary: Create time-off entry
      description: Create a new time-off entry (vacation, sick, personal day, or holiday)
      operationId: createTimeOff
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTimeOffRequest'
      responses:
        '201':
          description: Time-off entry created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeOffResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/time-off/{id}:
    put:
      tags:
        - Time Off
      summary: Update time-off entry
      description: Update an existing time-off entry
      operationId: updateTimeOff
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTimeOffRequest'
      responses:
        '200':
          description: Time-off entry updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeOffResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Time Off
      summary: Delete time-off entry
      description: Delete a time-off entry
      operationId: deleteTimeOff
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Time-off entry deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/vacation-balance:
    get:
      tags:
        - Vacation Balance
      summary: Get vacation balance
      description: Get vacation balance for the authenticated user for a specific year
      operationId: getVacationBalance
      parameters:
        - name: year
          in: query
          required: false
          schema:
            type: integer
          description: Year for vacation balance (defaults to current year)
          example: 2025
      responses:
        '200':
          description: Vacation balance retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VacationBalanceResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Vacation balance not found for the specified year
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Vacation Balance
      summary: Update vacation balance
      description: Update vacation balance (Admin only)
      operationId: updateVacationBalance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateVacationBalanceRequest'
      responses:
        '200':
          description: Vacation balance updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VacationBalanceResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /api/public-holidays:
    get:
      tags:
        - Public Holidays
      summary: Get public holidays
      description: Get German public holidays for a specific year and state
      operationId: getPublicHolidays
      parameters:
        - name: year
          in: query
          required: false
          schema:
            type: integer
          description: Year for public holidays (defaults to current year)
          example: 2025
        - name: state
          in: query
          required: false
          schema:
            type: string
            enum: [BERLIN, BRANDENBURG]
          description: German state (defaults to user's state)
          example: BERLIN
      responses:
        '200':
          description: Public holidays retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PublicHolidayResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/time-entries/clock-in:
    post:
      tags:
        - Time Entries
      summary: Clock in
      description: Start a new work session by clocking in
      operationId: clockIn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClockInRequest'
      responses:
        '201':
          description: Clocked in successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeEntryResponse'
        '400':
          description: Bad request (e.g., already clocked in)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/time-entries/clock-out:
    post:
      tags:
        - Time Entries
      summary: Clock out
      description: End the current work session by clocking out
      operationId: clockOut
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClockOutRequest'
      responses:
        '200':
          description: Clocked out successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeEntryResponse'
        '400':
          description: Bad request (e.g., not clocked in)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/time-entries:
    get:
      tags:
        - Time Entries
      summary: Get time entries
      description: Get time entries for the authenticated user within a date range
      operationId: getTimeEntries
      parameters:
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for filtering (ISO 8601 format)
          example: "2025-12-01"
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for filtering (ISO 8601 format)
          example: "2025-12-31"
      responses:
        '200':
          description: Time entries retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TimeEntryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    post:
      tags:
        - Time Entries
      summary: Create time entry
      description: Create a new time entry with both start and end times
      operationId: createTimeEntry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTimeEntryRequest'
      responses:
        '201':
          description: Time entry created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeEntryResponse'
        '400':
          description: Bad request (e.g., invalid times, overlapping entries)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/time-entries/daily-summary:
    get:
      tags:
        - Time Entries
      summary: Get daily summary
      description: Get daily summaries with actual vs expected hours for the authenticated user
      operationId: getDailySummary
      parameters:
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for summary (ISO 8601 format)
          example: "2025-12-01"
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for summary (ISO 8601 format)
          example: "2025-12-31"
      responses:
        '200':
          description: Daily summary retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DailySummaryResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/time-entries/{id}:
    put:
      tags:
        - Time Entries
      summary: Update time entry
      description: Update an existing time entry
      operationId: updateTimeEntry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTimeEntryRequest'
      responses:
        '200':
          description: Time entry updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeEntryResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Time entry not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - Time Entries
      summary: Delete time entry
      description: Delete a time entry
      operationId: deleteTimeEntry
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Time entry deleted successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Time entry not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/time-entries/monthly-report:
    get:
      tags:
        - Time Entries
      summary: Export monthly time report as PDF
      description: Generate PDF report for a specific month with daily entries
      operationId: exportMonthlyReport
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
          description: Year for the report
          example: 2025
        - name: month
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 12
          description: Month for the report (1-12)
          example: 12
      responses:
        '200':
          description: PDF report generated successfully
          content:
            application/pdf:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              schema:
                type: string
              description: Attachment filename
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: admin@timetrack.local
        password:
          type: string
          format: password
          example: admin

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

    AuthResponse:
      type: object
      required:
        - accessToken
        - refreshToken
        - tokenType
        - expiresIn
      properties:
        accessToken:
          type: string
          description: JWT access token
        refreshToken:
          type: string
          description: JWT refresh token
        tokenType:
          type: string
          example: Bearer
        expiresIn:
          type: integer
          format: int64
          description: Access token expiration time in seconds
        user:
          $ref: '#/components/schemas/UserResponse'

    UserResponse:
      type: object
      required:
        - id
        - email
        - firstName
        - lastName
        - role
        - active
        - state
      properties:
        id:
          type: integer
          format: int64
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        role:
          type: string
          enum: [ADMIN, USER]
        active:
          type: boolean
        state:
          type: string
          enum: [BERLIN, BRANDENBURG]
          description: German state for public holiday calculation
          example: BERLIN
        halfDayHolidaysEnabled:
          type: boolean
          description: Whether half-day holidays (Dec 24 & 31) are enabled for this user
          default: false
          example: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateUserRequest:
      type: object
      required:
        - email
        - password
        - firstName
        - lastName
        - role
      properties:
        email:
          type: string
          format: email
          example: user@timetrack.local
        password:
          type: string
          format: password
          minLength: 6
          example: password123
        firstName:
          type: string
          minLength: 1
          maxLength: 100
          example: Max
        lastName:
          type: string
          minLength: 1
          maxLength: 100
          example: Mustermann
        role:
          type: string
          enum: [ADMIN, USER]
          example: USER
        active:
          type: boolean
          default: true
          example: true
        state:
          type: string
          enum: [BERLIN, BRANDENBURG]
          description: German state for public holiday calculation
          default: BERLIN
          example: BERLIN
        halfDayHolidaysEnabled:
          type: boolean
          description: Whether half-day holidays (Dec 24 & 31) are enabled for this user
          default: false
          example: false

    UpdateUserRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: user@timetrack.local
        password:
          type: string
          format: password
          minLength: 6
          description: Only include if changing password
          example: newpassword123
        firstName:
          type: string
          minLength: 1
          maxLength: 100
          example: Max
        lastName:
          type: string
          minLength: 1
          maxLength: 100
          example: Mustermann
        role:
          type: string
          enum: [ADMIN, USER]
          description: Only admins can change roles
          example: USER
        active:
          type: boolean
          description: Only admins can change active status
          example: true
        state:
          type: string
          enum: [BERLIN, BRANDENBURG]
          description: German state for public holiday calculation
          example: BERLIN
        halfDayHolidaysEnabled:
          type: boolean
          description: Whether half-day holidays (Dec 24 & 31) are enabled for this user
          example: false

    ErrorResponse:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Error code
        message:
          type: string
          description: Error message in German
        details:
          type: string
          description: Additional error details
        timestamp:
          type: string
          format: date-time

    WorkingHoursResponse:
      type: object
      required:
        - userId
        - workingDays
      properties:
        userId:
          type: integer
          format: int64
          description: ID of the user
        workingDays:
          type: array
          description: Working hours configuration for each weekday
          items:
            $ref: '#/components/schemas/WorkingDayConfig'

    WorkingDayConfig:
      type: object
      required:
        - weekday
        - hours
        - isWorkingDay
      properties:
        id:
          type: integer
          format: int64
          description: Working hours configuration ID
        weekday:
          type: integer
          minimum: 1
          maximum: 7
          description: Day of week (1=Monday, 7=Sunday)
          example: 1
        dayName:
          type: string
          description: Name of the day
          enum: [MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY]
          example: MONDAY
        hours:
          type: number
          format: double
          minimum: 0
          maximum: 24
          description: Target hours for this weekday
          example: 8.0
        isWorkingDay:
          type: boolean
          description: Whether this is a working day
          example: true
        startTime:
          type: string
          format: time
          description: Optional start time (HH:mm format). When set with endTime, hours are calculated automatically
          example: "09:00"
        endTime:
          type: string
          format: time
          description: Optional end time (HH:mm format). When set with startTime, hours are calculated automatically
          example: "17:00"

    UpdateWorkingHoursRequest:
      type: object
      required:
        - workingDays
      properties:
        workingDays:
          type: array
          description: Working hours configuration for each weekday (must contain all 7 days)
          minItems: 7
          maxItems: 7
          items:
            $ref: '#/components/schemas/UpdateWorkingDayConfig'

    UpdateWorkingDayConfig:
      type: object
      required:
        - weekday
        - hours
        - isWorkingDay
      properties:
        weekday:
          type: integer
          minimum: 1
          maximum: 7
          description: Day of week (1=Monday, 7=Sunday)
          example: 1
        hours:
          type: number
          format: double
          minimum: 0
          maximum: 24
          description: Target hours for this weekday. If startTime and endTime are provided, this will be calculated automatically
          example: 8.0
        isWorkingDay:
          type: boolean
          description: Whether this is a working day
          example: true
        startTime:
          type: string
          format: time
          description: Optional start time (HH:mm format). When set with endTime, hours are calculated automatically
          example: "09:00"
        endTime:
          type: string
          format: time
          description: Optional end time (HH:mm format). When set with startTime, hours are calculated automatically
          example: "17:00"

    RecurringOffDayResponse:
      type: object
      required:
        - id
        - userId
        - recurrencePattern
        - weekday
        - startDate
        - isActive
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        recurrencePattern:
          type: string
          enum: [EVERY_NTH_WEEK, NTH_WEEKDAY_OF_MONTH]
          description: Type of recurrence pattern
        weekday:
          type: integer
          minimum: 1
          maximum: 7
          description: Day of week (1=Monday, 7=Sunday)
        weekInterval:
          type: integer
          description: Week interval for EVERY_NTH_WEEK pattern (e.g., 4 for every 4 weeks)
          example: 4
        referenceDate:
          type: string
          format: date
          description: Reference start date for EVERY_NTH_WEEK pattern
          example: "2025-01-06"
        weekOfMonth:
          type: integer
          minimum: 1
          maximum: 5
          description: Week of month for NTH_WEEKDAY_OF_MONTH pattern (1-5, where 5 means last)
          example: 4
        startDate:
          type: string
          format: date
          description: Date when this rule becomes active
        endDate:
          type: string
          format: date
          description: Optional end date for this rule
        isActive:
          type: boolean
          description: Whether this rule is currently active
        description:
          type: string
          description: Optional description of this off-day rule
          example: "Every 4th Monday"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateRecurringOffDayRequest:
      type: object
      required:
        - recurrencePattern
        - weekday
        - startDate
      properties:
        recurrencePattern:
          type: string
          enum: [EVERY_NTH_WEEK, NTH_WEEKDAY_OF_MONTH]
          description: Type of recurrence pattern
        weekday:
          type: integer
          minimum: 1
          maximum: 7
          description: Day of week (1=Monday, 7=Sunday)
        weekInterval:
          type: integer
          description: Required for EVERY_NTH_WEEK pattern (e.g., 4 for every 4 weeks)
          example: 4
        referenceDate:
          type: string
          format: date
          description: Required for EVERY_NTH_WEEK pattern
          example: "2025-01-06"
        weekOfMonth:
          type: integer
          minimum: 1
          maximum: 5
          description: Required for NTH_WEEKDAY_OF_MONTH pattern (1-5, where 5 means last)
          example: 4
        startDate:
          type: string
          format: date
          description: Date when this rule becomes active
          example: "2025-01-01"
        endDate:
          type: string
          format: date
          description: Optional end date for this rule
        description:
          type: string
          description: Optional description of this off-day rule
          example: "Every 4th Monday"

    UpdateRecurringOffDayRequest:
      type: object
      properties:
        recurrencePattern:
          type: string
          enum: [EVERY_NTH_WEEK, NTH_WEEKDAY_OF_MONTH]
          description: Type of recurrence pattern
        weekday:
          type: integer
          minimum: 1
          maximum: 7
          description: Day of week (1=Monday, 7=Sunday)
        weekInterval:
          type: integer
          description: Required for EVERY_NTH_WEEK pattern
          example: 4
        referenceDate:
          type: string
          format: date
          description: Required for EVERY_NTH_WEEK pattern
          example: "2025-01-06"
        weekOfMonth:
          type: integer
          minimum: 1
          maximum: 5
          description: Required for NTH_WEEKDAY_OF_MONTH pattern
          example: 4
        startDate:
          type: string
          format: date
          description: Date when this rule becomes active
        endDate:
          type: string
          format: date
          description: Optional end date for this rule
        isActive:
          type: boolean
          description: Whether this rule is currently active
        description:
          type: string
          description: Optional description of this off-day rule

    RecurringOffDayConflictWarningResponse:
      type: object
      required:
        - id
        - userId
        - conflictDate
        - acknowledged
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        conflictDate:
          type: string
          format: date
          description: Date when the conflict occurred
          example: "2024-11-24"
        timeEntryId:
          type: integer
          format: int64
          description: ID of the time entry that conflicts
        recurringOffDayId:
          type: integer
          format: int64
          description: ID of the recurring off-day rule
        recurringOffDayDescription:
          type: string
          description: Description of the conflicting recurring off-day
          example: "Every 4th Monday"
        acknowledged:
          type: boolean
          description: Whether the user has acknowledged this warning
          example: false
        acknowledgedAt:
          type: string
          format: date-time
          description: When the warning was acknowledged
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TimeOffResponse:
      type: object
      required:
        - id
        - userId
        - startDate
        - endDate
        - timeOffType
        - days
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        startDate:
          type: string
          format: date
          description: First day of time-off
          example: "2025-07-01"
        endDate:
          type: string
          format: date
          description: Last day of time-off (inclusive)
          example: "2025-07-15"
        timeOffType:
          type: string
          enum: [VACATION, SICK, CHILD_SICK, PERSONAL, PUBLIC_HOLIDAY]
          description: Type of time-off
        days:
          type: number
          format: double
          description: Number of working days (excludes weekends, holidays, and recurring off-days; may include fractional days for half-day holidays)
          example: 10.5
        hoursPerDay:
          type: number
          format: double
          description: Optional hours per day override (uses working hours if not set)
          example: 8.0
        notes:
          type: string
          description: Optional notes about this time-off
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateTimeOffRequest:
      type: object
      required:
        - startDate
        - endDate
        - timeOffType
      properties:
        startDate:
          type: string
          format: date
          description: First day of time-off
          example: "2025-07-01"
        endDate:
          type: string
          format: date
          description: Last day of time-off (inclusive)
          example: "2025-07-15"
        timeOffType:
          type: string
          enum: [VACATION, SICK, CHILD_SICK, PERSONAL, PUBLIC_HOLIDAY]
          description: Type of time-off
        hoursPerDay:
          type: number
          format: double
          description: Optional hours per day override
          example: 8.0
        notes:
          type: string
          description: Optional notes about this time-off
          example: "Summer vacation"

    UpdateTimeOffRequest:
      type: object
      properties:
        startDate:
          type: string
          format: date
          description: First day of time-off
        endDate:
          type: string
          format: date
          description: Last day of time-off (inclusive)
        timeOffType:
          type: string
          enum: [VACATION, SICK, CHILD_SICK, PERSONAL, PUBLIC_HOLIDAY]
          description: Type of time-off
        hoursPerDay:
          type: number
          format: double
          description: Optional hours per day override
        notes:
          type: string
          description: Optional notes about this time-off

    VacationBalanceResponse:
      type: object
      required:
        - id
        - userId
        - year
        - annualAllowanceDays
        - carriedOverDays
        - adjustmentDays
        - plannedDays
        - usedDays
        - remainingDays
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        year:
          type: integer
          description: Calendar year
          example: 2025
        annualAllowanceDays:
          type: number
          format: double
          description: Annual vacation allowance in days
          example: 30.0
        carriedOverDays:
          type: number
          format: double
          description: Days carried over from previous year
          example: 5.0
        adjustmentDays:
          type: number
          format: double
          description: Manual adjustments (bonus days, etc.)
          example: 2.0
        plannedDays:
          type: number
          format: double
          description: Total vacation days planned for this year (all approved vacation entries)
          example: 15.0
        usedDays:
          type: number
          format: double
          description: Vacation days already taken (past approved vacation entries)
          example: 5.0
        remainingDays:
          type: number
          format: double
          description: Remaining vacation days available for planning
          example: 24.5
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UpdateVacationBalanceRequest:
      type: object
      required:
        - userId
        - year
      properties:
        userId:
          type: integer
          format: int64
          description: User ID to update balance for
        year:
          type: integer
          description: Calendar year
          example: 2025
        annualAllowanceDays:
          type: number
          format: double
          description: Annual vacation allowance in days
          example: 30.0
        carriedOverDays:
          type: number
          format: double
          description: Days carried over from previous year
          example: 5.0
        adjustmentDays:
          type: number
          format: double
          description: Manual adjustments (bonus days, etc.)
          example: 2.0

    PublicHolidayResponse:
      type: object
      required:
        - date
        - name
        - isStateSpecific
      properties:
        date:
          type: string
          format: date
          description: Date of the holiday
          example: "2025-12-25"
        name:
          type: string
          description: Name of the holiday
          example: "Weihnachten"
        isStateSpecific:
          type: boolean
          description: Whether this holiday is state-specific
          example: false

    ClockInRequest:
      type: object
      properties:
        notes:
          type: string
          description: Optional notes for this work session

    ClockOutRequest:
      type: object
      properties:
        notes:
          type: string
          description: Optional notes for this work session

    TimeEntryResponse:
      type: object
      required:
        - id
        - userId
        - entryDate
        - clockIn
        - entryType
        - isActive
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        entryDate:
          type: string
          format: date
          description: Date of the time entry
          example: "2025-12-12"
        clockIn:
          type: string
          format: date-time
          description: Clock in timestamp
          example: "2025-12-12T08:30:00"
        clockOut:
          type: string
          format: date-time
          description: Clock out timestamp (null if still active)
          example: "2025-12-12T17:00:00"
        breakMinutes:
          type: integer
          description: Break duration in minutes
          default: 0
          example: 30
        entryType:
          type: string
          enum: [WORK]
          description: Type of time entry (only WORK supported; absences use TimeOff entity)
          example: "WORK"
        hoursWorked:
          type: number
          format: double
          description: Hours worked (null if still active)
          example: 8.5
        isActive:
          type: boolean
          description: Whether this entry is still active (not clocked out)
          example: false
        notes:
          type: string
          description: Optional notes
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateTimeEntryRequest:
      type: object
      required:
        - clockIn
        - clockOut
        - entryType
      properties:
        clockIn:
          type: string
          format: date-time
          description: Clock in timestamp
        clockOut:
          type: string
          format: date-time
          description: Clock out timestamp
        breakMinutes:
          type: integer
          description: Break duration in minutes
          default: 0
          example: 30
        entryType:
          type: string
          enum: [WORK]
          default: WORK
          description: Type of time entry (only WORK supported; absences use TimeOff entity)
        notes:
          type: string

    UpdateTimeEntryRequest:
      type: object
      required:
        - clockIn
        - entryType
      properties:
        clockIn:
          type: string
          format: date-time
          description: Clock in timestamp
        clockOut:
          type: string
          format: date-time
          description: Clock out timestamp
        breakMinutes:
          type: integer
          description: Break duration in minutes
          default: 0
          example: 30
        entryType:
          type: string
          enum: [WORK]
          description: Type of time entry (only WORK supported; absences use TimeOff entity)
        notes:
          type: string

    DailySummaryResponse:
      type: object
      required:
        - date
        - actualHours
        - expectedHours
        - status
      properties:
        date:
          type: string
          format: date
          description: The date for this summary
          example: "2025-12-12"
        actualHours:
          type: number
          format: double
          description: Total hours worked on this date
          example: 8.5
        expectedHours:
          type: number
          format: double
          description: Expected hours for this date (from working hours config)
          example: 8.0
        status:
          type: string
          enum: [NO_ENTRY, BELOW_EXPECTED, MATCHED, ABOVE_EXPECTED]
          description: Status comparing actual vs expected hours
          example: "ABOVE_EXPECTED"
        entries:
          type: array
          description: List of time entries for this date
          items:
            $ref: '#/components/schemas/TimeEntryResponse'
        timeOffEntries:
          type: array
          description: List of time-off entries that cover this date
          items:
            $ref: '#/components/schemas/TimeOffResponse'
        recurringOffDays:
          type: array
          description: List of recurring off-days that apply to this date
          items:
            $ref: '#/components/schemas/RecurringOffDayResponse'
        conflictWarning:
          $ref: '#/components/schemas/RecurringOffDayConflictWarningResponse'
          description: Warning if work entry conflicts with recurring off-day

  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ForbiddenError:
      description: User does not have permission to access this resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    BadRequestError:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
